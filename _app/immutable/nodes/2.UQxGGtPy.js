import"../chunks/DsnmJJEf.js";import{i as De}from"../chunks/BgVwrkR8.js";import{aY as be,h as we,r as Ee,aZ as Me,N as Ie,q as fe,n as i,ae as I,V as m,w as re,k as Re,x as L,C as _,y as X,z as B,A as w,B as se,ag as de,D as b,F as g,G as K,a_ as ke,a$ as Ae,Z as Ue,ad as ye}from"../chunks/CXQ_toU2.js";import{p as xe,i as W}from"../chunks/B6ni4WJ9.js";import{f as j,e as te,i as oe,r as ue,d as Be,a as P}from"../chunks/67WaCcYF.js";import{b as Fe}from"../chunks/DqinSY4r.js";const ee=new Set;function me(o,e,t,a,r=a){var n=t.getAttribute("type")==="checkbox",s=o;let u=!1;if(e!==null)for(var k of e)s=s[k]??=[];s.push(t),be(t,"change",()=>{var c=t.__value;n&&(c=pe(s,c,t.checked)),r(c)},()=>r(n?[]:null)),Ee(()=>{var c=a();if(we&&t.defaultChecked!==t.checked){u=!0;return}n?(c=c||[],t.checked=c.includes(t.__value)):t.checked=Me(t.__value,c)}),Ie(()=>{var c=s.indexOf(t);c!==-1&&s.splice(c,1)}),ee.has(s)||(ee.add(s),fe(()=>{s.sort((c,v)=>c.compareDocumentPosition(v)===4?-1:1),ee.delete(s)})),fe(()=>{if(u){var c;if(n)c=pe(s,c,t.checked);else{var v=s.find(O=>O.checked);c=v?.__value}r(c)}})}function pe(o,e,t){for(var a=new Set,r=0;r<o.length;r+=1)o[r].checked&&a.add(o[r].__value);return t||a.delete(e),Array.from(a)}function Ne(o,e,t=e){be(o,"change",()=>{t(o.files)}),we&&o.files&&t(o.files),Ee(()=>{o.files=e()})}var l;(function(o){o.LOAD="LOAD",o.EXEC="EXEC",o.FFPROBE="FFPROBE",o.WRITE_FILE="WRITE_FILE",o.READ_FILE="READ_FILE",o.DELETE_FILE="DELETE_FILE",o.RENAME="RENAME",o.CREATE_DIR="CREATE_DIR",o.LIST_DIR="LIST_DIR",o.DELETE_DIR="DELETE_DIR",o.ERROR="ERROR",o.DOWNLOAD="DOWNLOAD",o.PROGRESS="PROGRESS",o.LOG="LOG",o.MOUNT="MOUNT",o.UNMOUNT="UNMOUNT"})(l||(l={}));const Se=(()=>{let o=0;return()=>o++})(),Ce=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Te=new Error("called FFmpeg.terminate()");class Pe{#t=null;#a={};#o={};#r=[];#s=[];loaded=!1;#i=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:t,data:a}})=>{switch(t){case l.LOAD:this.loaded=!0,this.#a[e](a);break;case l.MOUNT:case l.UNMOUNT:case l.EXEC:case l.FFPROBE:case l.WRITE_FILE:case l.READ_FILE:case l.DELETE_FILE:case l.RENAME:case l.CREATE_DIR:case l.LIST_DIR:case l.DELETE_DIR:this.#a[e](a);break;case l.LOG:this.#r.forEach(r=>r(a));break;case l.PROGRESS:this.#s.forEach(r=>r(a));break;case l.ERROR:this.#o[e](a);break}delete this.#a[e],delete this.#o[e]})};#e=({type:e,data:t},a=[],r)=>this.#t?new Promise((n,s)=>{const u=Se();this.#t&&this.#t.postMessage({id:u,type:e,data:t},a),this.#a[u]=n,this.#o[u]=s,r?.addEventListener("abort",()=>{s(new DOMException(`Message # ${u} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Ce);on(e,t){e==="log"?this.#r.push(t):e==="progress"&&this.#s.push(t)}off(e,t){e==="log"?this.#r=this.#r.filter(a=>a!==t):e==="progress"&&(this.#s=this.#s.filter(a=>a!==t))}load=({classWorkerURL:e,...t}={},{signal:a}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("../workers/worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"}),this.#i()),this.#e({type:l.LOAD,data:t},void 0,a));exec=(e,t=-1,{signal:a}={})=>this.#e({type:l.EXEC,data:{args:e,timeout:t}},void 0,a);ffprobe=(e,t=-1,{signal:a}={})=>this.#e({type:l.FFPROBE,data:{args:e,timeout:t}},void 0,a);terminate=()=>{const e=Object.keys(this.#o);for(const t of e)this.#o[t](Te),delete this.#o[t],delete this.#a[t];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,t,{signal:a}={})=>{const r=[];return t instanceof Uint8Array&&r.push(t.buffer),this.#e({type:l.WRITE_FILE,data:{path:e,data:t}},r,a)};mount=(e,t,a)=>{const r=[];return this.#e({type:l.MOUNT,data:{fsType:e,options:t,mountPoint:a}},r)};unmount=e=>{const t=[];return this.#e({type:l.UNMOUNT,data:{mountPoint:e}},t)};readFile=(e,t="binary",{signal:a}={})=>this.#e({type:l.READ_FILE,data:{path:e,encoding:t}},void 0,a);deleteFile=(e,{signal:t}={})=>this.#e({type:l.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:a}={})=>this.#e({type:l.RENAME,data:{oldPath:e,newPath:t}},void 0,a);createDir=(e,{signal:t}={})=>this.#e({type:l.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#e({type:l.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#e({type:l.DELETE_DIR,data:{path:e}},void 0,t)}var he;(function(o){o.MEMFS="MEMFS",o.NODEFS="NODEFS",o.NODERAWFS="NODERAWFS",o.IDBFS="IDBFS",o.WORKERFS="WORKERFS",o.PROXYFS="PROXYFS"})(he||(he={}));const je=""+new URL("../assets/ffmpeg-core.CI9Irx9p.js",import.meta.url).href,We=""+new URL("../assets/ffmpeg-core.CgUfceKH.wasm",import.meta.url).href;let x,ae=I(!1);function ze(){return i(ae)}async function $e(){i(ae)||(x=new Pe,await x.load({coreURL:je,wasmURL:We}),console.log("FFmpeg loaded successfully."),m(ae,!0))}const Ge=/\[sound=(?<url>.*)]/,Ye=["jpg","jpeg","png","gif"],Ze=["mp4","webm"],Xe=["mp3","wav","ogg"];function Ke(o){const e=o.match(Ge);let t=null;return e&&e.groups&&e.groups.url&&(t=decodeURIComponent(e.groups.url),t.startsWith("http")||(t="https://"+t)),t}function V(o){const e=o.split(".").pop()?.toLowerCase();if(e){if(Ye.includes(e))return"image";if(Ze.includes(e))return"video";if(Xe.includes(e))return"audio"}return"unknown"}function qe(o){return o.replaceAll(/\[.+?\]/g,"").split(".")[0].trim()}function He(o){const e=o.split(".");return e.length>1&&e.pop()?.toLowerCase()||null}let Le={};const ve=new WeakMap,ge={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class Ve{constructor(e,t){t=Object.assign({units:"metric",precision:1,locale:void 0},Le,t),ve.set(this,t),Object.assign(ge,t.customUnits);const a=e<0?"-":"";e=Math.abs(e);const r=ge[t.units];if(r){const n=r.find(s=>e>=s.from&&e<s.to);if(n){const s=new Intl.NumberFormat(t.locale,{style:"decimal",maximumFractionDigits:t.precision}),u=n.from===0?a+s.format(e):a+s.format(e/n.from);this.value=u,this.unit=n.unit,this.long=n.long}else this.value=a+e,this.unit="",this.long=""}else throw new Error(`Invalid units specified: ${t.units}`)}toString(){const e=ve.get(this);return e.toStringFn?e.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function ie(o,e){return new Ve(o,e)}ie.defaultOptions=function(o){Le=o};var Je=L("<video controls><source/> Your browser does not support the video tag.</video>",2),Qe=L('<img alt="Selected image"/>'),et=L('<p> </p> <div id="media" class="svelte-ydtd5s"><!></div>',1),tt=L('<label for="source_media">Upload a video or image.</label> <input id="source_media" name="source_media" type="file"/> <!>',1);function ot(o,e){re(e,!0);const t=["video/mp4","video/webm"],a=["image/jpeg","image/png","image/gif"];let r=xe(e,"current_file",15),n=I(void 0);Re(()=>{i(n)&&i(n).length>0?r(i(n)[0]):r(null)});let s=I(void 0);var u=tt(),k=_(X(u),2),c=_(k,2);{var v=O=>{var q=de(),J=X(q);te(J,17,()=>Array.from(i(n)),oe,(z,A)=>{var H=et(),$=X(H),f=b($);g($);var h=_($,2),d=b(h);{var F=D=>{var U=Je(),N=b(U);ke(),g(U),B(G=>{j(N,"src",G),j(N,"type",i(A).type)},[()=>URL.createObjectURL(i(A))]),w(D,U)},E=D=>{var U=de(),N=X(U);{var G=Y=>{var S=Qe();Fe(S,C=>m(s,C),()=>i(s)),B(C=>j(S,"src",C),[()=>URL.createObjectURL(i(A))]),w(Y,S)};W(N,Y=>{V(i(A).name)==="image"&&Y(G)},!0)}w(D,U)};W(d,D=>{V(i(A).name)==="video"?D(F):D(E,!1)})}g(h),B(D=>K(f,`Original size: ${D??""}`),[()=>ie(i(A).size,{units:"iec"})]),w(z,H)}),w(O,q)};W(c,O=>{i(n)&&O(v)})}B(O=>j(k,"accept",O),[()=>[...t,...a].join(",")]),Ne(k,()=>i(n),O=>m(n,O)),w(o,u),se()}const at=o=>new Promise((e,t)=>{const a=new FileReader;a.onload=()=>{const{result:r}=a;r instanceof ArrayBuffer?e(new Uint8Array(r)):e(new Uint8Array)},a.onerror=r=>{t(Error(`File could not be read! Code=${r?.target?.error?.code||-1}`))},a.readAsArrayBuffer(o)}),_e=async o=>{let e;if(typeof o=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?e=atob(o.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(o)).arrayBuffer();else if(o instanceof URL)e=await(await fetch(o)).arrayBuffer();else if(o instanceof File||o instanceof Blob)e=await at(o);else return new Uint8Array;return new Uint8Array(e)};var rt=L('<label class="svelte-3d06rk"><input type="radio" name="preset" class="svelte-3d06rk"/> </label>'),st=L('<label class="svelte-3d06rk"><input type="radio" name="tune" class="svelte-3d06rk"/> </label>'),it=(o,e)=>e(),nt=L('<button class="svelte-3d06rk">Merge</button>'),lt=L('<p class="svelte-3d06rk"> <span class="loader svelte-3d06rk"></span></p>'),ct=L('<form class="svelte-3d06rk"><label class="svelte-3d06rk"><b class="svelte-3d06rk">FFmpeg settings</b></label> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Preset</legend> <p class="svelte-3d06rk">Slower will yield higher quality encodes.</p> <div class="options svelte-3d06rk"></div></fieldset> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Tune</legend> <p class="svelte-3d06rk">Optimize the output for specific content types.</p> <div class="options svelte-3d06rk"></div></fieldset></form> <br class="svelte-3d06rk"/> <!> <div class="svelte-3d06rk"><p class="svelte-3d06rk"> </p> <video controls class="svelte-3d06rk"></video> <p class="svelte-3d06rk"><a class="svelte-3d06rk"><button class="svelte-3d06rk">Download</button></a></p></div>',3),ft=L(`<article class="svelte-3d06rk"><header class="svelte-3d06rk"><h3 class="svelte-3d06rk">Merger</h3> <small class="svelte-3d06rk">Downloads the linked sound file and merges it back into the video (or image). Useful for
			archiving.</small></header> <!> <!></article>`);function dt(o,e){re(e,!0);const t=[],a=[];let r=I("fast"),n=I("none"),s=I(Ue(new Blob)),u=I(""),k=I(!1),c=I(!1),v=I(null);ye(()=>{x.on("log",({message:f})=>{console.log(f)}),x.on("progress",({progress:f,time:h})=>{m(u,"Merging files... "+(f*100).toFixed(2)+"%")})}),Re(()=>{i(v)&&(m(k,!1),m(c,!1),V(i(v).name)==="image"?m(n,"stillimage"):m(n,"none"))});async function O(){if(!i(v)){P.push("No file selected.");return}m(k,!0),m(u,"Downloading sound...");const f=await J(i(v).name);if(!f||!f.blob){P.push("Failed to extract sound from file."),m(k,!1);return}m(u,"Launching ffmpeg...");let h={name:i(v).name,blob:i(v)};try{await q(h,f)}catch(d){P.push(`FFmpeg error: ${d}`),m(k,!1);return}P.push("FFmpeg finished."),m(k,!1),m(c,!0)}async function q(f,h){await x.writeFile(f.name,await _e(f.blob)),await x.writeFile(h.name,await _e(h.blob));let d=["-i",f.name,"-i",h.name];V(f.name)=="image"&&(d.unshift("-loop","1","-r","1"),d.push("-shortest","-r","1")),d.push("-map","0:v","-map","1:a"),d.push("-preset",i(r)),i(n)!=="none"&&d.push("-tune",i(n)),d.push("-pix_fmt:v","yuv420p"),d.push("output.mp4"),console.log("Running ffmpeg command:","ffmpeg "+d.join(" ")),await x.exec(d);const E=await x.readFile("output.mp4");m(s,new Blob([E],{type:"video/mp4"}),!0)}async function J(f){let h=Ke(f);if(!h){P.push("Invalid sound URL.");return}console.log("Downloading sound from URL:",h);let d=null;return await fetch(h).then(E=>{if(!E.ok){P.push("Failed to download sound.");return}return E.blob()}).then(E=>{d=E}).catch(E=>{console.error("Error downloading sound:",E),P.push("Error downloading sound.")}),{name:"sound."+He(h),blob:d}}var z=ft(),A=_(b(z),2);ot(A,{get current_file(){return i(v)},set current_file(f){m(v,f,!0)}});var H=_(A,2);{var $=f=>{var h=ct(),d=X(h),F=_(b(d),2),E=_(b(F),4);te(E,20,()=>["veryslow","slow","medium","fast","veryfast","ultrafast"],oe,(y,p)=>{var M=rt(),R=b(M);ue(R);var Z,Q=_(R);g(M),B(T=>{Z!==(Z=p)&&(R.value=(R.__value=p)??""),K(Q,` ${T??""}`)},[()=>p.charAt(0).toUpperCase()+p.slice(1)]),me(t,[],R,()=>i(r),T=>m(r,T)),w(y,M)}),g(E),g(F);var D=_(F,2),U=_(b(D),4);te(U,20,()=>["none","film","animation","stillimage"],oe,(y,p)=>{var M=st(),R=b(M);ue(R);var Z,Q=_(R);g(M),B(T=>{Z!==(Z=p)&&(R.value=(R.__value=p)??""),K(Q,` ${T??""}`)},[()=>p.charAt(0).toUpperCase()+p.slice(1)]),me(a,[],R,()=>i(n),T=>m(n,T)),w(y,M)}),g(U),g(D),g(d);var N=_(d,4);{var G=y=>{var p=nt();p.__click=[it,O],w(y,p)},Y=y=>{var p=lt(),M=b(p);ke(),g(p),B(()=>K(M,`${i(u)??""} `)),w(y,p)};W(N,y=>{i(k)?y(Y,!1):y(G)})}var S=_(N,2),C=b(S),Oe=b(C);g(C);var ne=_(C,2),le=_(ne,2),ce=b(le);g(le),g(S),B((y,p,M,R)=>{Be(S,`display: ${i(c)?"blocks":"none"}`),K(Oe,`Final size: ${y??""}`),j(ne,"src",p),j(ce,"href",M),j(ce,"download",`${R??""}.mp4`)},[()=>ie(i(s).size,{units:"iec"}),()=>URL.createObjectURL(i(s)),()=>URL.createObjectURL(i(s)),()=>qe(i(v).name)+"_merged"]),w(f,h)};W(H,f=>{i(v)&&f($)})}g(z),w(o,z),se()}Ae(["click"]);var ut=L("<p>Loading FFmpeg...</p>"),mt=L("<main><!></main>");function wt(o,e){re(e,!1),ye(()=>{$e()}),De();var t=mt(),a=b(t);{var r=s=>{dt(s,{})},n=s=>{var u=ut();w(s,u)};W(a,s=>{ze()?s(r):s(n,!1)})}g(t),w(o,t),se()}export{wt as component};

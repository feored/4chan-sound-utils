import"../chunks/DsnmJJEf.js";import"../chunks/DyPBEnF7.js";import{aG as tt,q as et,h as ot,w as H,i as it,x as g,F as w,y as N,z as k,A as h,B as q,aD as Y,C as L,D as O,l,G as rt,aH as at,aB as G,V as y,aI as nt,aA as st,aE as lt}from"../chunks/CyvWxf-k.js";import{p as ct,i as I}from"../chunks/DnyE7_IL.js";import{b as V}from"../chunks/GrpE8Nc7.js";import{s as S,e as ut,i as ft,t as R}from"../chunks/DHBsuA-o.js";function dt(o,t,e=t){tt(o,"change",()=>{e(o.files)}),ot&&o.files&&e(o.files),et(()=>{o.files=t()})}const mt=/\[sound=(?<url>.*)]/,ht=["jpg","jpeg","png","gif"],pt=["mp4","webm"],gt=["mp3","wav","ogg"];function Et(o){const t=o.match(mt);let e=null;return t&&t.groups&&t.groups.url&&(e=decodeURIComponent(t.groups.url),e.startsWith("http")||(e="https://"+e)),e}function z(o){const t=o.split(".").pop()?.toLowerCase();if(t){if(ht.includes(t))return"image";if(pt.includes(t))return"video";if(gt.includes(t))return"audio"}return"unknown"}let J={};const $=new WeakMap,X={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class wt{constructor(t,e){e=Object.assign({units:"metric",precision:1,locale:void 0},J,e),$.set(this,e),Object.assign(X,e.customUnits);const i=t<0?"-":"";t=Math.abs(t);const r=X[e.units];if(r){const c=r.find(s=>t>=s.from&&t<s.to);if(c){const s=new Intl.NumberFormat(e.locale,{style:"decimal",maximumFractionDigits:e.precision}),d=c.from===0?i+s.format(t):i+s.format(t/c.from);this.value=d,this.unit=c.unit,this.long=c.long}else this.value=i+t,this.unit="",this.long=""}else throw new Error(`Invalid units specified: ${e.units}`)}toString(){const t=$.get(this);return t.toStringFn?t.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function Q(o,t){return new wt(o,t)}Q.defaultOptions=function(o){J=o};var vt=g("<video controls><source/> Your browser does not support the video tag.</video>",2),_t=g('<img alt="Selected image"/>'),bt=g('<p> </p> <div id="media" class="svelte-ydtd5s"><!></div>',1),Rt=g('<label for="source_media">Upload a video or image.</label> <input id="source_media" name="source_media" type="file"/> <!>',1);function Lt(o,t){H(t,!0);const e=["video/mp4","video/webm"],i=["image/jpeg","image/png","image/gif"];let r=ct(t,"files",15),c=G(void 0);it(()=>{r()&&console.log(r())});var s=Rt(),d=w(N(s),2),F=w(d,2);{var T=D=>{var v=Y(),A=N(v);ut(A,17,()=>Array.from(r()),ft,(B,p)=>{var U=bt(),n=N(U),f=L(n);O(n);var u=w(n,2),_=L(u);{var M=m=>{var b=vt(),x=L(b);at(),O(b),k(P=>{S(x,"src",P),S(x,"type",l(p).type)},[()=>URL.createObjectURL(l(p))]),h(m,b)},E=m=>{var b=Y(),x=N(b);{var P=C=>{var W=_t();V(W,j=>y(c,j),()=>l(c)),k(j=>S(W,"src",j),[()=>URL.createObjectURL(l(p))]),h(C,W)};I(x,C=>{z(l(p).name)==="image"&&C(P)},!0)}h(m,b)};I(_,m=>{z(l(p).name)==="video"?m(M):m(E,!1)})}O(u),k(m=>rt(f,`Filesize: ${m??""}`),[()=>Q(l(p).size,{units:"iec"})]),h(B,U)}),h(D,v)};I(F,D=>{r()&&D(T)})}k(()=>S(d,"accept",e+", "+i)),dt(d,r),h(o,s),q()}var a;(function(o){o.LOAD="LOAD",o.EXEC="EXEC",o.FFPROBE="FFPROBE",o.WRITE_FILE="WRITE_FILE",o.READ_FILE="READ_FILE",o.DELETE_FILE="DELETE_FILE",o.RENAME="RENAME",o.CREATE_DIR="CREATE_DIR",o.LIST_DIR="LIST_DIR",o.DELETE_DIR="DELETE_DIR",o.ERROR="ERROR",o.DOWNLOAD="DOWNLOAD",o.PROGRESS="PROGRESS",o.LOG="LOG",o.MOUNT="MOUNT",o.UNMOUNT="UNMOUNT"})(a||(a={}));const Ot=(()=>{let o=0;return()=>o++})(),Dt=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Mt=new Error("called FFmpeg.terminate()");class yt{#e=null;#i={};#o={};#r=[];#a=[];loaded=!1;#n=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:e,data:i}})=>{switch(e){case a.LOAD:this.loaded=!0,this.#i[t](i);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.FFPROBE:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:this.#i[t](i);break;case a.LOG:this.#r.forEach(r=>r(i));break;case a.PROGRESS:this.#a.forEach(r=>r(i));break;case a.ERROR:this.#o[t](i);break}delete this.#i[t],delete this.#o[t]})};#t=({type:t,data:e},i=[],r)=>this.#e?new Promise((c,s)=>{const d=Ot();this.#e&&this.#e.postMessage({id:d,type:t,data:e},i),this.#i[d]=c,this.#o[d]=s,r?.addEventListener("abort",()=>{s(new DOMException(`Message # ${d} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Dt);on(t,e){t==="log"?this.#r.push(e):t==="progress"&&this.#a.push(e)}off(t,e){t==="log"?this.#r=this.#r.filter(i=>i!==e):t==="progress"&&(this.#a=this.#a.filter(i=>i!==e))}load=({classWorkerURL:t,...e}={},{signal:i}={})=>(this.#e||(this.#e=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("../workers/worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"}),this.#n()),this.#t({type:a.LOAD,data:e},void 0,i));exec=(t,e=-1,{signal:i}={})=>this.#t({type:a.EXEC,data:{args:t,timeout:e}},void 0,i);ffprobe=(t,e=-1,{signal:i}={})=>this.#t({type:a.FFPROBE,data:{args:t,timeout:e}},void 0,i);terminate=()=>{const t=Object.keys(this.#o);for(const e of t)this.#o[e](Mt),delete this.#o[e],delete this.#i[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,e,{signal:i}={})=>{const r=[];return e instanceof Uint8Array&&r.push(e.buffer),this.#t({type:a.WRITE_FILE,data:{path:t,data:e}},r,i)};mount=(t,e,i)=>{const r=[];return this.#t({type:a.MOUNT,data:{fsType:t,options:e,mountPoint:i}},r)};unmount=t=>{const e=[];return this.#t({type:a.UNMOUNT,data:{mountPoint:t}},e)};readFile=(t,e="binary",{signal:i}={})=>this.#t({type:a.READ_FILE,data:{path:t,encoding:e}},void 0,i);deleteFile=(t,{signal:e}={})=>this.#t({type:a.DELETE_FILE,data:{path:t}},void 0,e);rename=(t,e,{signal:i}={})=>this.#t({type:a.RENAME,data:{oldPath:t,newPath:e}},void 0,i);createDir=(t,{signal:e}={})=>this.#t({type:a.CREATE_DIR,data:{path:t}},void 0,e);listDir=(t,{signal:e}={})=>this.#t({type:a.LIST_DIR,data:{path:t}},void 0,e);deleteDir=(t,{signal:e}={})=>this.#t({type:a.DELETE_DIR,data:{path:t}},void 0,e)}var Z;(function(o){o.MEMFS="MEMFS",o.NODEFS="NODEFS",o.NODERAWFS="NODERAWFS",o.IDBFS="IDBFS",o.WORKERFS="WORKERFS",o.PROXYFS="PROXYFS"})(Z||(Z={}));const It=o=>new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{const{result:r}=i;r instanceof ArrayBuffer?t(new Uint8Array(r)):t(new Uint8Array)},i.onerror=r=>{e(Error(`File could not be read! Code=${r?.target?.error?.code||-1}`))},i.readAsArrayBuffer(o)}),K=async o=>{let t;if(typeof o=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?t=atob(o.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(o)).arrayBuffer();else if(o instanceof URL)t=await(await fetch(o)).arrayBuffer();else if(o instanceof File||o instanceof Blob)t=await It(o);else return new Uint8Array;return new Uint8Array(t)};var At=(o,t)=>t(),Bt=g('<span class="loader svelte-os1xcu"></span>'),Ut=g('<div style="display:flex" class="svelte-os1xcu"><button class="svelte-os1xcu">Merge</button> <!></div>'),xt=g('<article class="svelte-os1xcu"><h3 class="svelte-os1xcu">Merger</h3> <!> <!> <p class="svelte-os1xcu">output</p> <video controls class="svelte-os1xcu"></video></article>',2);function Nt(o,t){H(t,!0);let e,i,r=G(!1),c=G(void 0),s=lt(()=>l(c)&&l(c).length>0?l(c)[0]:null);st(async()=>{await F(),console.log("FFmpeg loaded.")});async function d(){if(!l(s)){R.push("No file selected to merge with.");return}y(r,!0);const n=await D();if(!n){R.push("No sound blob to merge with."),y(r,!1);return}T(l(s),l(s).name,n,"sound.webm"),y(r,!1)}async function F(){const n="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm";e=new yt,e.on("log",({message:f})=>{console.log(f)}),console.log("Loading ffmpeg-core.js"),await e.load({coreURL:`${n}/ffmpeg-core.js`,wasmURL:`${n}/ffmpeg-core.wasm`})}async function T(n,f,u,_){await e.writeFile(f,await K(n)),await e.writeFile(_,await K(u)),await e.exec(["-i",f,"-i",_,"output.webm"]);const M=await e.readFile("output.webm");console.log("done");const E=M;i.src=URL.createObjectURL(new Blob([E],{type:"video/mp4"}))}async function D(){let n=Et(l(s).name);if(!n){R.push("Invalid sound URL.");return}if(z(n)!=="audio"){R.push("Sound URL file format is not supported.");return}console.log("Downloading sound from URL:",n);let f=null;return await fetch(n).then(u=>{if(!u.ok){R.push("Failed to download sound.");return}return u.blob()}).then(u=>{f=u}).catch(u=>{console.error("Error downloading sound:",u),R.push("Error downloading sound.")}),f}var v=xt(),A=w(L(v),2);Lt(A,{get files(){return l(c)},set files(n){y(c,n,!0)}});var B=w(A,2);{var p=n=>{var f=Ut(),u=L(f);u.__click=[At,d];var _=w(u,2);{var M=E=>{var m=Bt();h(E,m)};I(_,E=>{l(r)&&E(M)})}O(f),h(n,f)};I(B,n=>{l(s)&&n(p)})}var U=w(B,4);V(U,n=>i=n,()=>i),O(v),h(o,v),q()}nt(["click"]);var kt=g("<main><!></main>");function jt(o){var t=kt(),e=L(t);Nt(e,{}),O(t),h(o,t)}export{jt as component};

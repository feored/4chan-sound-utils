import"../chunks/DsnmJJEf.js";import{i as ze}from"../chunks/BgVwrkR8.js";import{aY as Ae,h as Ue,r as xe,aZ as $e,N as Ge,q as Re,n as r,ae as L,V as u,w as _e,k as Be,x as k,C as _,y as q,z as S,A as b,B as ge,ag as ye,D as g,F as f,G as K,a_ as se,a$ as Ye,Z as Ze,ad as Fe}from"../chunks/CXQ_toU2.js";import{p as Xe,i as $}from"../chunks/B6ni4WJ9.js";import{f as z,e as ie,i as ne,r as te,d as Ke,a as W}from"../chunks/67WaCcYF.js";import{b as qe}from"../chunks/DqinSY4r.js";const ve=new Set;function ae(a,e,t,o,i=o){var d=t.getAttribute("type")==="checkbox",s=a;let v=!1;if(e!==null)for(var x of e)s=s[x]??=[];s.push(t),Ae(t,"change",()=>{var n=t.__value;d&&(n=Me(s,n,t.checked)),i(n)},()=>i(d?[]:null)),xe(()=>{var n=o();if(Ue&&t.defaultChecked!==t.checked){v=!0;return}d?(n=n||[],t.checked=n.includes(t.__value)):t.checked=$e(t.__value,n)}),Ge(()=>{var n=s.indexOf(t);n!==-1&&s.splice(n,1)}),ve.has(s)||(ve.add(s),Re(()=>{s.sort((n,D)=>n.compareDocumentPosition(D)===4?-1:1),ve.delete(s)})),Re(()=>{if(v){var n;if(d)n=Me(s,n,t.checked);else{var D=s.find(R=>R.checked);n=D?.__value}i(n)}})}function Me(a,e,t){for(var o=new Set,i=0;i<a.length;i+=1)a[i].checked&&o.add(a[i].__value);return t||o.delete(e),Array.from(o)}function He(a,e,t=e){Ae(a,"change",()=>{t(a.files)}),Ue&&a.files&&t(a.files),xe(()=>{a.files=e()})}var l;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.FFPROBE="FFPROBE",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(l||(l={}));const Ve=(()=>{let a=0;return()=>a++})(),Je=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Qe=new Error("called FFmpeg.terminate()");class et{#t=null;#o={};#a={};#r=[];#s=[];loaded=!1;#i=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:t,data:o}})=>{switch(t){case l.LOAD:this.loaded=!0,this.#o[e](o);break;case l.MOUNT:case l.UNMOUNT:case l.EXEC:case l.FFPROBE:case l.WRITE_FILE:case l.READ_FILE:case l.DELETE_FILE:case l.RENAME:case l.CREATE_DIR:case l.LIST_DIR:case l.DELETE_DIR:this.#o[e](o);break;case l.LOG:this.#r.forEach(i=>i(o));break;case l.PROGRESS:this.#s.forEach(i=>i(o));break;case l.ERROR:this.#a[e](o);break}delete this.#o[e],delete this.#a[e]})};#e=({type:e,data:t},o=[],i)=>this.#t?new Promise((d,s)=>{const v=Ve();this.#t&&this.#t.postMessage({id:v,type:e,data:t},o),this.#o[v]=d,this.#a[v]=s,i?.addEventListener("abort",()=>{s(new DOMException(`Message # ${v} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Je);on(e,t){e==="log"?this.#r.push(t):e==="progress"&&this.#s.push(t)}off(e,t){e==="log"?this.#r=this.#r.filter(o=>o!==t):e==="progress"&&(this.#s=this.#s.filter(o=>o!==t))}load=({classWorkerURL:e,...t}={},{signal:o}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("../workers/worker-BAOIWoxA.js",import.meta.url).href,import.meta.url),{type:"module"}),this.#i()),this.#e({type:l.LOAD,data:t},void 0,o));exec=(e,t=-1,{signal:o}={})=>this.#e({type:l.EXEC,data:{args:e,timeout:t}},void 0,o);ffprobe=(e,t=-1,{signal:o}={})=>this.#e({type:l.FFPROBE,data:{args:e,timeout:t}},void 0,o);terminate=()=>{const e=Object.keys(this.#a);for(const t of e)this.#a[t](Qe),delete this.#a[t],delete this.#o[t];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,t,{signal:o}={})=>{const i=[];return t instanceof Uint8Array&&i.push(t.buffer),this.#e({type:l.WRITE_FILE,data:{path:e,data:t}},i,o)};mount=(e,t,o)=>{const i=[];return this.#e({type:l.MOUNT,data:{fsType:e,options:t,mountPoint:o}},i)};unmount=e=>{const t=[];return this.#e({type:l.UNMOUNT,data:{mountPoint:e}},t)};readFile=(e,t="binary",{signal:o}={})=>this.#e({type:l.READ_FILE,data:{path:e,encoding:t}},void 0,o);deleteFile=(e,{signal:t}={})=>this.#e({type:l.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:o}={})=>this.#e({type:l.RENAME,data:{oldPath:e,newPath:t}},void 0,o);createDir=(e,{signal:t}={})=>this.#e({type:l.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#e({type:l.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#e({type:l.DELETE_DIR,data:{path:e}},void 0,t)}var Oe;(function(a){a.MEMFS="MEMFS",a.NODEFS="NODEFS",a.NODERAWFS="NODERAWFS",a.IDBFS="IDBFS",a.WORKERFS="WORKERFS",a.PROXYFS="PROXYFS"})(Oe||(Oe={}));const tt=""+new URL("../assets/ffmpeg-core.CI9Irx9p.js",import.meta.url).href,at=""+new URL("../assets/ffmpeg-core.CgUfceKH.wasm",import.meta.url).href,ot=/\[sound=(?<url>.*)]/,rt=["jpg","jpeg","png","gif"],st=["mp4","webm"],it=["mp3","wav","ogg"];function nt(a){const e=a.match(ot);let t=null;return e&&e.groups&&e.groups.url&&(t=decodeURIComponent(e.groups.url),t.startsWith("http")||(t="https://"+t)),t}function le(a){const e=a.split(".").pop()?.toLowerCase();if(e){if(rt.includes(e))return"image";if(st.includes(e))return"video";if(it.includes(e))return"audio"}return"unknown"}function lt(a){return a.replaceAll(/\[.+?\]/g,"").split(".")[0].trim()}function dt(a){const e=a.split(".");return e.length>1&&e.pop()?.toLowerCase()||null}let T,pe=L(!1);function ct(){return r(pe)}async function ut(){r(pe)||(T=new et,await T.load({coreURL:tt,wasmURL:at}),console.log("FFmpeg loaded successfully."),u(pe,!0))}function ft(a,e,t){let o=["-i",a.name,"-i",e.name];return le(a.name)=="image"&&(o.unshift("-loop","1","-r","1"),o.push("-vf","pad=ceil(iw/2)*2:ceil(ih/2)*2"),o.push("-shortest","-r","1")),o.push("-map","0:v","-map","1:a"),o.push("-c:v","libx264"),o.push("-preset",t.preset),t.tune!=="none"&&o.push("-tune",t.tune),o.push("-pix_fmt:v","yuv420p"),o.push("output.mp4"),o}function mt(a,e,t){let o=["-i",a.name,"-i",e.name,"-c:v","libvpx","-b:v",t.bitrate,"-c:a","libvorbis","-b:a","256k"];return o.push("output.webm"),o}let Ne={};const Le=new WeakMap,De={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class vt{constructor(e,t){t=Object.assign({units:"metric",precision:1,locale:void 0},Ne,t),Le.set(this,t),Object.assign(De,t.customUnits);const o=e<0?"-":"";e=Math.abs(e);const i=De[t.units];if(i){const d=i.find(s=>e>=s.from&&e<s.to);if(d){const s=new Intl.NumberFormat(t.locale,{style:"decimal",maximumFractionDigits:t.precision}),v=d.from===0?o+s.format(e):o+s.format(e/d.from);this.value=v,this.unit=d.unit,this.long=d.long}else this.value=o+e,this.unit="",this.long=""}else throw new Error(`Invalid units specified: ${t.units}`)}toString(){const e=Le.get(this);return e.toStringFn?e.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function he(a,e){return new vt(a,e)}he.defaultOptions=function(a){Ne=a};var pt=k("<video controls><source/> Your browser does not support the video tag.</video>",2),_t=k('<img alt="Selected image"/>'),gt=k('<p> </p> <div id="media" class="svelte-ydtd5s"><!></div>',1),ht=k('<label for="source_media">Upload a video or image.</label> <input id="source_media" name="source_media" type="file"/> <!>',1);function bt(a,e){_e(e,!0);const t=["video/mp4","video/webm"],o=["image/jpeg","image/png","image/gif"];let i=Xe(e,"current_file",15),d=L(void 0);Be(()=>{r(d)&&r(d).length>0?i(r(d)[0]):i(null)});let s=L(void 0);var v=ht(),x=_(q(v),2),n=_(x,2);{var D=R=>{var B=ye(),H=q(B);ie(H,17,()=>Array.from(r(d)),ne,(M,C)=>{var oe=gt(),V=q(oe),J=g(V);f(V);var Q=_(V,2),de=g(Q);{var ce=c=>{var p=pt(),A=g(p);se(),f(p),S(w=>{z(A,"src",w),z(A,"type",r(C).type)},[()=>URL.createObjectURL(r(C))]),b(c,p)},m=c=>{var p=ye(),A=q(p);{var w=I=>{var P=_t();qe(P,G=>u(s,G),()=>r(s)),S(G=>z(P,"src",G),[()=>URL.createObjectURL(r(C))]),b(I,P)};$(A,I=>{le(r(C).name)==="image"&&I(w)},!0)}b(c,p)};$(de,c=>{le(r(C).name)==="video"?c(ce):c(m,!1)})}f(Q),S(c=>K(J,`Original size: ${c??""}`),[()=>he(r(C).size,{units:"iec"})]),b(M,oe)}),b(R,B)};$(n,R=>{r(d)&&R(D)})}S(R=>z(x,"accept",R),[()=>[...t,...o].join(",")]),He(x,()=>r(d),R=>u(d,R)),b(a,v),ge()}const wt=a=>new Promise((e,t)=>{const o=new FileReader;o.onload=()=>{const{result:i}=o;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},o.onerror=i=>{t(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},o.readAsArrayBuffer(a)}),Ie=async a=>{let e;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?e=atob(a.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)e=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)e=await wt(a);else return new Uint8Array;return new Uint8Array(e)};var Et=k('<label class="svelte-3d06rk"><input type="radio" name="webm_bitrate" class="svelte-3d06rk"/> </label>'),kt=k('<fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Target Bitrate</legend> <div class="options svelte-3d06rk"></div></fieldset>'),Rt=k('<label class="svelte-3d06rk"><input type="radio" name="preset" class="svelte-3d06rk"/> </label>'),yt=k('<label class="svelte-3d06rk"><input type="radio" name="tune" class="svelte-3d06rk"/> </label>'),Mt=k('<fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Preset</legend> <p class="svelte-3d06rk">Slower will yield higher quality encodes.</p> <div class="options svelte-3d06rk"></div></fieldset> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Tune</legend> <p class="svelte-3d06rk">Optimize the output for specific content types.</p> <div class="options svelte-3d06rk"></div></fieldset>',1),Ot=(a,e)=>e(),Lt=k('<button class="svelte-3d06rk">Merge</button>'),Dt=k('<p class="svelte-3d06rk"> <span class="loader svelte-3d06rk"></span></p>'),It=k('<form class="svelte-3d06rk"><label class="svelte-3d06rk"><b class="svelte-3d06rk">FFmpeg settings</b></label> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Output format</legend> <p class="svelte-3d06rk">MP4 highly recommended.</p> <div class="options svelte-3d06rk"><label class="svelte-3d06rk"><input type="radio" name="output_format" class="svelte-3d06rk"/> MP4 (H.264)</label> <label class="svelte-3d06rk"><input type="radio" name="output_format" class="svelte-3d06rk"/> WebM (VP8 + 256k Vorbis)</label></div></fieldset> <!></form> <br class="svelte-3d06rk"/> <!> <div class="svelte-3d06rk"><p class="svelte-3d06rk"> </p> <video controls class="svelte-3d06rk"></video> <p class="svelte-3d06rk"><a class="svelte-3d06rk"><button class="svelte-3d06rk">Download</button></a></p></div>',3),At=k(`<article class="svelte-3d06rk"><header class="svelte-3d06rk"><h3 class="svelte-3d06rk">Merger</h3> <small class="svelte-3d06rk">Downloads the linked sound file and merges it back into the video (or image). Useful for
			archiving.</small></header> <!> <!></article>`);function Ut(a,e){_e(e,!0);const t=[],o=[],i=[],d=[];let s=L("fast"),v=L("none"),x=L("1M"),n=L("mp4"),D=L(Ze(new Blob)),R=L(""),B=L(!1),H=L(!1),M=L(null);Fe(()=>{T.on("log",({message:m})=>{console.log(m)}),T.on("progress",({progress:m,time:c})=>{u(R,"Merging files... "+(m*100).toFixed(2)+"%")})}),Be(()=>{r(M)&&(u(D,new Blob,!0),u(B,!1),u(H,!1),le(r(M).name)==="image"?u(v,"stillimage"):u(v,"none"))});async function C(){if(!r(M)){W.push("No file selected.");return}u(B,!0),u(R,"Downloading sound...");const m=await V(r(M).name);if(!m||!m.blob){W.push("Failed to extract sound from file."),u(B,!1);return}u(R,"Launching ffmpeg...");let c={name:r(M).name,blob:r(M)};try{await oe(c,m)}catch(p){W.push(`FFmpeg error: ${p}`),u(B,!1);return}W.push("FFmpeg finished."),u(B,!1),u(H,!0)}async function oe(m,c){await T.writeFile(m.name,await Ie(m.blob)),await T.writeFile(c.name,await Ie(c.blob));let p=[];if(r(n)==="webm"){let I={bitrate:r(x)};p=mt(m,c,I)}else{let I={preset:r(s),tune:r(v)};p=ft(m,c,I)}console.log("Running ffmpeg command:","ffmpeg "+p.join(" ")),await T.exec(p);const w=await T.readFile(`output.${r(n)}`);u(D,new Blob([w],{type:`video/${r(n)}`}),!0)}async function V(m){let c=nt(m);if(!c){W.push("Invalid sound URL.");return}console.log("Downloading sound from URL:",c);let p=null;return await fetch(c).then(w=>{if(!w.ok){W.push("Failed to download sound.");return}return w.blob()}).then(w=>{p=w}).catch(w=>{console.error("Error downloading sound:",w),W.push("Error downloading sound.")}),{name:"sound."+dt(c),blob:p}}var J=At(),Q=_(g(J),2);bt(Q,{get current_file(){return r(M)},set current_file(m){u(M,m,!0)}});var de=_(Q,2);{var ce=m=>{var c=It(),p=q(c),A=_(g(p),2),w=_(g(A),4),I=g(w),P=g(I);te(P),P.value=P.__value="mp4",se(),f(I);var G=_(I,2),re=g(G);te(re),re.value=re.__value="webm",se(),f(G),f(w),f(A);var Se=_(A,2);{var Ce=h=>{var E=kt(),U=_(g(E),2);ie(U,20,()=>["500k","1M","2M","4M"],ne,(Y,Z)=>{var X=Et(),F=g(X);te(F);var O,N=_(F);f(X),S(()=>{O!==(O=Z)&&(F.value=(F.__value=Z)??""),K(N,` ${Z??""}`)}),ae(o,[],F,()=>r(x),y=>u(x,y)),b(Y,X)}),f(U),f(E),b(h,E)},Pe=h=>{var E=Mt(),U=q(E),Y=_(g(U),4);ie(Y,20,()=>["veryslow","slow","medium","fast","veryfast","ultrafast"],ne,(F,O)=>{var N=Rt(),y=g(N);te(y);var ee,me=_(y);f(N),S(j=>{ee!==(ee=O)&&(y.value=(y.__value=O)??""),K(me,` ${j??""}`)},[()=>O.charAt(0).toUpperCase()+O.slice(1)]),ae(i,[],y,()=>r(s),j=>u(s,j)),b(F,N)}),f(Y),f(U);var Z=_(U,2),X=_(g(Z),4);ie(X,20,()=>["none","film","animation","stillimage"],ne,(F,O)=>{var N=yt(),y=g(N);te(y);var ee,me=_(y);f(N),S(j=>{ee!==(ee=O)&&(y.value=(y.__value=O)??""),K(me,` ${j??""}`)},[()=>O.charAt(0).toUpperCase()+O.slice(1)]),ae(d,[],y,()=>r(v),j=>u(v,j)),b(F,N)}),f(X),f(Z),b(h,E)};$(Se,h=>{r(n)==="webm"?h(Ce):h(Pe,!1)})}f(p);var be=_(p,4);{var Te=h=>{var E=Lt();E.__click=[Ot,C],b(h,E)},je=h=>{var E=Dt(),U=g(E);se(),f(E),S(()=>K(U,`${r(R)??""} `)),b(h,E)};$(be,h=>{r(B)?h(je,!1):h(Te)})}var ue=_(be,2),fe=g(ue),We=g(fe);f(fe);var we=_(fe,2),Ee=_(we,2),ke=g(Ee);f(Ee),f(ue),S((h,E,U,Y)=>{Ke(ue,`display: ${r(H)?"blocks":"none"}`),K(We,`Final size: ${h??""}`),z(we,"src",E),z(ke,"href",U),z(ke,"download",`${Y??""}.webm`)},[()=>he(r(D).size,{units:"iec"}),()=>URL.createObjectURL(r(D)),()=>URL.createObjectURL(r(D)),()=>lt(r(M).name)]),ae(t,[],P,()=>r(n),h=>u(n,h)),ae(t,[],re,()=>r(n),h=>u(n,h)),b(m,c)};$(de,m=>{r(M)&&m(ce)})}f(J),b(a,J),ge()}Ye(["click"]);var xt=k("<p>Loading FFmpeg...</p>"),Bt=k("<main><!></main>");function jt(a,e){_e(e,!1),Fe(()=>{ut()}),ze();var t=Bt(),o=g(t);{var i=s=>{Ut(s,{})},d=s=>{var v=xt();b(s,v)};$(o,s=>{ct()?s(i):s(d,!1)})}f(t),b(a,t),ge()}export{jt as component};

import"../chunks/DsnmJJEf.js";import"../chunks/C_dyZWqb.js";import{aI as pe,q as _e,h as he,aJ as ye,N as Oe,t as ie,w as be,i as we,l as a,x as L,C as p,y as Z,z as A,A as w,B as ke,ae as D,V as f,ag as se,D as _,F as g,G as K,aK as Ee,aL as Le,Z as Be,ad as xe}from"../chunks/DLzJnzUn.js";import{p as De,i as X}from"../chunks/CkvrzwPq.js";import{s as P,e as ee,i as te,r as le,a as Ae,t as C}from"../chunks/CJUwiXRn.js";import{b as Ue}from"../chunks/DH3XyEd8.js";const Q=new Set;function ce(e,t,o,u,s=u){var n=o.getAttribute("type")==="checkbox",r=e;let k=!1;if(t!==null)for(var E of t)r=r[E]??=[];r.push(o),pe(o,"change",()=>{var i=o.__value;n&&(i=ue(r,i,o.checked)),s(i)},()=>s(n?[]:null)),_e(()=>{var i=u();if(he&&o.defaultChecked!==o.checked){k=!0;return}n?(i=i||[],o.checked=i.includes(o.__value)):o.checked=ye(o.__value,i)}),Oe(()=>{var i=r.indexOf(o);i!==-1&&r.splice(i,1)}),Q.has(r)||(Q.add(r),ie(()=>{r.sort((i,v)=>i.compareDocumentPosition(v)===4?-1:1),Q.delete(r)})),ie(()=>{if(k){var i;if(n)i=ue(r,i,o.checked);else{var v=r.find(M=>M.checked);i=v?.__value}s(i)}})}function ue(e,t,o){for(var u=new Set,s=0;s<e.length;s+=1)e[s].checked&&u.add(e[s].__value);return o||u.delete(t),Array.from(u)}function Ie(e,t,o=t){pe(e,"change",()=>{o(e.files)}),he&&e.files&&o(e.files),_e(()=>{e.files=t()})}var de;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(de||(de={}));var fe;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(fe||(fe={}));let j;const Se=/\[sound=(?<url>.*)]/,Ne=["jpg","jpeg","png","gif"],ze=["mp4","webm"],Ce=["mp3","wav","ogg"];function Pe(e){const t=e.match(Se);let o=null;return t&&t.groups&&t.groups.url&&(o=decodeURIComponent(t.groups.url),o.startsWith("http")||(o="https://"+o)),o}function J(e){const t=e.split(".").pop()?.toLowerCase();if(t){if(Ne.includes(t))return"image";if(ze.includes(t))return"video";if(Ce.includes(t))return"audio"}return"unknown"}function je(e){return e.replaceAll(/\[.+?\]/g,"").split(".")[0].trim()}function $e(e){const t=e.split(".");return t.length>1&&t.pop()?.toLowerCase()||null}let Re={};const me=new WeakMap,ve={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class We{constructor(t,o){o=Object.assign({units:"metric",precision:1,locale:void 0},Re,o),me.set(this,o),Object.assign(ve,o.customUnits);const u=t<0?"-":"";t=Math.abs(t);const s=ve[o.units];if(s){const n=s.find(r=>t>=r.from&&t<r.to);if(n){const r=new Intl.NumberFormat(o.locale,{style:"decimal",maximumFractionDigits:o.precision}),k=n.from===0?u+r.format(t):u+r.format(t/n.from);this.value=k,this.unit=n.unit,this.long=n.long}else this.value=u+t,this.unit="",this.long=""}else throw new Error(`Invalid units specified: ${o.units}`)}toString(){const t=me.get(this);return t.toStringFn?t.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function oe(e,t){return new We(e,t)}oe.defaultOptions=function(e){Re=e};var Ge=L("<video controls><source/> Your browser does not support the video tag.</video>",2),Fe=L('<img alt="Selected image"/>'),Ye=L('<p> </p> <div id="media" class="svelte-ydtd5s"><!></div>',1),Ze=L('<label for="source_media">Upload a video or image.</label> <input id="source_media" name="source_media" type="file"/> <!>',1);function Ke(e,t){be(t,!0);const o=["video/mp4","video/webm"],u=["image/jpeg","image/png","image/gif"];let s=De(t,"current_file",15),n=D(void 0);we(()=>{a(n)&&a(n).length>0?s(a(n)[0]):s(null)});let r=D(void 0);var k=Ze(),E=p(Z(k),2),i=p(E,2);{var v=M=>{var q=se(),V=Z(q);ee(V,17,()=>Array.from(a(n)),te,($,B)=>{var T=Ye(),W=Z(T),l=_(W);g(W);var m=p(W,2),c=_(m);{var U=y=>{var x=Ge(),I=_(x);Ee(),g(x),A(G=>{P(I,"src",G),P(I,"type",a(B).type)},[()=>URL.createObjectURL(a(B))]),w(y,x)},h=y=>{var x=se(),I=Z(x);{var G=F=>{var S=Fe();Ue(S,N=>f(r,N),()=>a(r)),A(N=>P(S,"src",N),[()=>URL.createObjectURL(a(B))]),w(F,S)};X(I,F=>{J(a(B).name)==="image"&&F(G)},!0)}w(y,x)};X(c,y=>{J(a(B).name)==="video"?y(U):y(h,!1)})}g(m),A(y=>K(l,`Original size: ${y??""}`),[()=>oe(a(B).size,{units:"iec"})]),w($,T)}),w(M,q)};X(i,M=>{a(n)&&M(v)})}A(M=>P(E,"accept",M),[()=>[...o,...u].join(",")]),Ie(E,()=>a(n),M=>f(n,M)),w(e,k),ke()}const Xe=e=>new Promise((t,o)=>{const u=new FileReader;u.onload=()=>{const{result:s}=u;s instanceof ArrayBuffer?t(new Uint8Array(s)):t(new Uint8Array)},u.onerror=s=>{o(Error(`File could not be read! Code=${s?.target?.error?.code||-1}`))},u.readAsArrayBuffer(e)}),ge=async e=>{let t;if(typeof e=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(o=>o.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else if(e instanceof File||e instanceof Blob)t=await Xe(e);else return new Uint8Array;return new Uint8Array(t)};var qe=L('<label class="svelte-3d06rk"><input type="radio" name="preset" class="svelte-3d06rk"/> </label>'),Te=L('<label class="svelte-3d06rk"><input type="radio" name="tune" class="svelte-3d06rk"/> </label>'),Je=(e,t)=>t(),Ve=L('<button class="svelte-3d06rk">Merge</button>'),He=L('<p class="svelte-3d06rk"> <span class="loader svelte-3d06rk"></span></p>'),Qe=L('<form class="svelte-3d06rk"><label class="svelte-3d06rk"><b class="svelte-3d06rk">FFmpeg settings</b></label> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Preset</legend> <p class="svelte-3d06rk">Slower will yield higher quality encodes.</p> <div class="options svelte-3d06rk"></div></fieldset> <fieldset class="svelte-3d06rk"><legend class="svelte-3d06rk">Tune</legend> <p class="svelte-3d06rk">Optimize the output for specific content types.</p> <div class="options svelte-3d06rk"></div></fieldset></form> <br class="svelte-3d06rk"/> <!> <div class="svelte-3d06rk"><p class="svelte-3d06rk"> </p> <video controls class="svelte-3d06rk"></video> <p class="svelte-3d06rk"><a class="svelte-3d06rk"><button class="svelte-3d06rk">Download</button></a></p></div>',3),et=L(`<article class="svelte-3d06rk"><header class="svelte-3d06rk"><h3 class="svelte-3d06rk">Merger</h3> <small class="svelte-3d06rk">Downloads the linked sound file and merges it back into the video (or image). Useful for
			archiving.</small></header> <!> <!></article>`);function tt(e,t){be(t,!0);const o=[],u=[];let s=D("fast"),n=D("none"),r=D(Be(new Blob)),k=D(""),E=D(!1),i=D(!1),v=D(null);xe(()=>{j.on("log",({message:l})=>{console.log(l)}),j.on("progress",({progress:l,time:m})=>{f(k,"Merging files... "+(l*100).toFixed(2)+"%")})}),we(()=>{a(v)&&(f(E,!1),f(i,!1),J(a(v).name)==="image"?f(n,"stillimage"):f(n,"none"))});async function M(){if(!a(v)){C.push("No file selected.");return}f(E,!0),f(k,"Downloading sound...");const l=await V(a(v).name);if(!l||!l.blob){C.push("Failed to extract sound from file."),f(E,!1);return}f(k,"Launching ffmpeg...");let m={name:a(v).name,blob:a(v)};try{await q(m,l)}catch(c){C.push(`FFmpeg error: ${c}`),f(E,!1);return}C.push("FFmpeg finished."),f(E,!1),f(i,!0)}async function q(l,m){await j.writeFile(l.name,await ge(l.blob)),await j.writeFile(m.name,await ge(m.blob));let c=["-i",l.name,"-i",m.name];J(l.name)=="image"&&(c.unshift("-loop","1","-r","1"),c.push("-shortest","-r","1")),c.push("-map","0:v","-map","1:a"),c.push("-preset",a(s)),a(n)!=="none"&&c.push("-tune",a(n)),c.push("-pix_fmt:v","yuv420p"),c.push("output.mp4"),console.log("Running ffmpeg command:","ffmpeg "+c.join(" ")),await j.exec(c);const h=await j.readFile("output.mp4");f(r,new Blob([h],{type:"video/mp4"}),!0)}async function V(l){let m=Pe(l);if(!m){C.push("Invalid sound URL.");return}console.log("Downloading sound from URL:",m);let c=null;return await fetch(m).then(h=>{if(!h.ok){C.push("Failed to download sound.");return}return h.blob()}).then(h=>{c=h}).catch(h=>{console.error("Error downloading sound:",h),C.push("Error downloading sound.")}),{name:"sound."+$e(m),blob:c}}var $=et(),B=p(_($),2);Ke(B,{get current_file(){return a(v)},set current_file(l){f(v,l,!0)}});var T=p(B,2);{var W=l=>{var m=Qe(),c=Z(m),U=p(_(c),2),h=p(_(U),4);ee(h,20,()=>["veryslow","slow","medium","fast","veryfast","ultrafast"],te,(R,d)=>{var O=qe(),b=_(O);le(b);var Y,H=p(b);g(O),A(z=>{Y!==(Y=d)&&(b.value=(b.__value=d)??""),K(H,` ${z??""}`)},[()=>d.charAt(0).toUpperCase()+d.slice(1)]),ce(o,[],b,()=>a(s),z=>f(s,z)),w(R,O)}),g(h),g(U);var y=p(U,2),x=p(_(y),4);ee(x,20,()=>["none","film","animation","stillimage"],te,(R,d)=>{var O=Te(),b=_(O);le(b);var Y,H=p(b);g(O),A(z=>{Y!==(Y=d)&&(b.value=(b.__value=d)??""),K(H,` ${z??""}`)},[()=>d.charAt(0).toUpperCase()+d.slice(1)]),ce(u,[],b,()=>a(n),z=>f(n,z)),w(R,O)}),g(x),g(y),g(c);var I=p(c,4);{var G=R=>{var d=Ve();d.__click=[Je,M],w(R,d)},F=R=>{var d=He(),O=_(d);Ee(),g(d),A(()=>K(O,`${a(k)??""} `)),w(R,d)};X(I,R=>{a(E)?R(F,!1):R(G)})}var S=p(I,2),N=_(S),Me=_(N);g(N);var ae=p(N,2),re=p(ae,2),ne=_(re);g(re),g(S),A((R,d,O,b)=>{Ae(S,`display: ${a(i)?"blocks":"none"}`),K(Me,`Final size: ${R??""}`),P(ae,"src",d),P(ne,"href",O),P(ne,"download",`${b??""}.mp4`)},[()=>oe(a(r).size,{units:"iec"}),()=>URL.createObjectURL(a(r)),()=>URL.createObjectURL(a(r)),()=>je(a(v).name)+"_merged"]),w(l,m)};X(T,l=>{a(v)&&l(W)})}g($),w(e,$),ke()}Le(["click"]);var ot=L("<main><!></main>");function ct(e){var t=ot(),o=_(t);tt(o,{}),g(t),w(e,t)}export{ct as component};
